#!/bin/bash
# Wickwood Maketing Drupal 6 Site Starter Platform Builder Script

# Define the Platform Name from input variable
platform_dir=$1

# Call the Drush Make to create the platform
drush make wwm-drupal-6-site-starter.make /data/disk/wwmhosting-admin/static/$platform_dir
 
# Set permissions on sites directory
chmod g+w /data/disk/wwmhosting-admin/static/$platform_dir/sites

# Set permissions on DOMPDF font cache directory
# chmod go+w /data/disk/wwmhosting-admin/static/$platform_dir/sites/all/libraries/dompdf/lib/fonts

# Remove getid3 libraries demo directory for security
rm -r /data/disk/wwmhosting-admin/static/$platform_dir/sites/all/libraries/getid3/demos

# Setup textile libraries
# mkdir /data/disk/wwmhosting-admin/static/$platform_dir/sites/all/libraries/textile
# cp /data/disk/wwmhosting-admin/static/$platform_dir/sites/all/libraries/textpattern/textpattern/lib/classTextile.php /data/disk/wwmhosting-admin/static/$platform_dir/sites/all/libraries/textile
# rm -r /data/disk/wwmhosting-admin/static/$platform_dir/sites/all/libraries/textpattern

# Move jquery.ui to jquery_ui module because for some reason it is not being recognized in the 
# sites/all/libraries directory
# cp -r /data/disk/wwmhosting-admin/static/$platform_dir/sites/all/libraries/jquery.ui /data/disk/wwmhosting-admin/static/$platform_dir/sites/all/modules/jquery_ui
# mv /data/disk/wwmhosting-admin/static/$platform_dir/sites/all/libraries/jquery.ui /data/disk/wwmhosting-admin/static/$platform_dir/sites/all/libraries/jquery-org
# mv /data/disk/wwmhosting-admin/static/$platform_dir/sites/all/libraries/jquery-org/development-bundle /data/disk/wwmhosting-admin/static/$platform_dir/sites/all/libraries/jquery.ui
# rm -r /data/disk/wwmhosting-admin/static/$platform_dir/sites/all/libraries/jquery-org

# Setup wkhtmltopdf Library
cd /data/disk/wwmhosting-admin/static/$platform_dir/sites/all/libraries/wkhtmltopdf
tar xjf wkhtmltopdf-0.11.0_rc1-static-amd64.tar.bz2
cp -r wkhtmltopdf-amd64 /data/disk/wwmhosting-admin/static/$platform_dir/sites/all/modules/print/lib/wkhtmltopdf
chmod 775 /data/disk/wwmhosting-admin/static/$platform_dir/sites/all/modules/print/lib/wkhtmltopdf*
cd /data/disk/wwmhosting-admin/static/$platform_dir/sites/all/libraries
rm -r wkhtmltopdf

# Copy image.imagemagick.inc file to platform /includes file
cp /data/disk/wwmhosting-admin/static/$platform_dir/sites/all/modules/image/image.imagemagick.inc /data/disk/wwmhosting-admin/static/$platform_dir/includes/image.imagemagick.inc

# Move TinyMCE Spell Checker
rm -rf /data/disk/wwmhosting-admin/static/$platform_dir/sites/all/libraries/tinymce/jscripts/tiny_mce/plugins/spellchecker
mv  /data/disk/wwmhosting-admin/static/$platform_dir/sites/all/libraries/tinymce/jscripts/tiny_mce/plugins/spellchecker-new /data/disk/wwmhosting-admin/static/$platform_dir/sites/all/libraries/tinymce/jscripts/tiny_mce/plugins/spellchecker

# Change ownership of the platform
chown -R wwmhosting-admin.ftp /data/disk/wwmhosting-admin/static/$platform_dir